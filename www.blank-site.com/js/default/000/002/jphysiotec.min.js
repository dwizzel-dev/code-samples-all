function JAppz(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.uid=(new Date).getTime(),this.init=function(){this.debug("init()",this.args),$(document).data("jappzclass-"+this.uid,this),this.serverImagePath=this.args.serverImagePath,this.serverFormProcess=this.args.serverFormProcess,this.jlang=new JLang({jdebug:this.jdebug,path:this.args.serverCashPath,lang:this.args.localeLang}).init(),this.jutils=new JUtils({jdebug:this.jdebug,jlang:this.jlang}).init(),this.jserver=new JServer({jdebug:this.jdebug,jlang:this.jlang,path:this.args.serverCashPath,lang:this.args.localeLang,serverFormProcess:this.serverFormProcess}).init(),this.jcomm=new JComm({jdebug:this.jdebug,jlang:this.jlang,mainappz:this}).init(),this.jsearch=new JSearch({jdebug:this.jdebug,jlang:this.jlang,mainappz:this,jcomm:this.jcomm}).init(),this.jautocomplete=new JAutoComplete({jdebug:this.jdebug,jlang:this.jlang,mainappz:this,uid:this.uid,word:this.args.currentSearchedWord,focusoninput:this.args.focusOnInput}).init(),this.containerSize={h:0,w:0},this.mainContainer=this.args.mainContainer,this.searchContainer=this.args.searchContainer,this.containerSize={w:$(this.mainContainer).innerWidth(),h:$(this.mainContainer).innerHeight()},$(document).bind("jlang.Ready",this.jlangReady.bind(this,this.uid))},this.jlangReady=function(){this.debug("jlangReady()",arguments);var a=arguments[0];a==this.uid&&this.createSearchInterface()},this.createSearchInterface=function(){this.debug("createSearchInterface()");var a='<div class="bg-image"><img src="'+this.serverImagePath+'loupe.png"></div>';a+='<div class="nobg-fix"><img src="'+this.serverImagePath+'blank.png"></div>',a+='<div class="searchbox resizable">',a+='<div id="main-input-'+this.uid+'" class="kw-searchbox"></div>',a+="</div>",$(this.searchContainer).html(a),this.jautocomplete.create()},this.resetSearchWindowResult=function(){this.debug("resetSearchWindowResult()")},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JAutoComplete(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.jlang=this.args.jlang,this.mainAppz=this.args.mainappz,this.uid=this.args.uid,this.baseDivId="kw-content-result-"+this.uid,this.bFocusOnInput=this.args.focusoninput,this.arrInputBox=[],this.arrLastHintResult=[],this.bHaveAutoCompleteResult=!1,this.bFoundAutoCompleteMatch=!1,this.lastTypedWord="",this.lastSearchString="",this.firstLiWord="",this.currentSearchWord="",this.args.word,this.currentSearchWord=this.args.word,this.lastSearchString=this.args.word,this.bFoundAutoCompleteMatch=!0,this.bHaveAutoCompleteResult=!0,this.focusedKwIds="",this.minStrLen=1,this.lastAutoCompletePid={exercice:0},this.lastExercisePreviewPid=0,this.bEnableExercisePreview=!1,this.bEnableRemovePreview=!0,this.bEnableMouseOver=!1,this.timeDelay=0,this.timePreviewDelay=333,this.timerFetchAutoComplete=0,this.timerFetchExercisePreview=0,this.arrRefusedEvent=[9,16,17,18,19,20,33,34,35,36,37,39,44,45,112,113,114,115,116,117,118,119,120,121,122,123,144,145],this.arrKwType={1:"keywords",2:"short title"},this},this.create=function(){this.debug("create()"),this.addInputBox()},this.setLastTypedWord=function(a){this.debug("setLastTypedWord()",a),this.lastTypedWord=a},this.setCarretRange=function(a,b,c){this.debug("setCarretRange()",a,b,c),a.refinput.prop("selectionStart",b),a.refinput.prop("selectionEnd",c)},this.getLastTypedWord=function(){return this.debug("getLastTypedWord()"),this.lastTypedWord},this.setFirstLiWord=function(a){this.debug("setFirstLiWord()",a),this.firstLiWord=a},this.setLastSearchString=function(a){this.debug("setLastSearchString()",a),this.lastSearchString=a},this.getLastSearchString=function(){return this.debug("getLastSearchString()"),this.lastSearchString},this.getFirstLiWord=function(){return this.debug("getFirstLiWord()"),this.firstLiWord},this.setInputBoxText=function(a,b,c){this.debug("setInputBoxText()",a,b,c),c&&this.setInputBgBoxText(a,""),a.refinput.val(b)},this.setInputBgBoxText=function(a,b){this.debug("setInputBgBoxText()",a,b),a.refinputbg.val(b)},this.getCurrentWord=function(a){return this.debug("getCurrentWord()",a),this.currentSearchWord},this.getInputBoxText=function(a){return this.debug("getInputBoxText()",a),a.refinput.val()},this.trimStringBeginning=function(a){return this.debug("trimStringBeginning()",a),a.replace(/^\s+/gm,"")},this.trimStringEnding=function(a){return this.debug("trimStringEnding()",a),a.replace(/\s+$/gm,"")},this.setFocusedKwIds=function(a,b){this.debug("setFocusedKwIds()",a,b),this.focusedKwIds=a,this.currentSearchWord=b},this.getFocusedKwIds=function(){return this.debug("getFocusedKwIds()"),this.focusedKwIds},this.changeLiFocus=function(a,b){this.debug("changeLiFocus()",a,b),clearTimeout(this.timerFetchExercisePreview),this.lastExercisePreviewPid=0;var c="#"+this.baseDivId+" > UL.listing",d=parseInt($(c).attr("focus-id"));this.bEnableRemovePreview&&0!=d&&($("#"+this.baseDivId+" #lisr"+d+" > UL.exercises").css({display:"none"}),"1"==$("#"+this.baseDivId+" #lisr"+d).attr("preview-loaded")&&$("#"+this.baseDivId+" #lisr"+d).attr("preview-loaded","2"));var e=d,f=parseInt($(c).attr("focus-id-max"));"up"==a?(d--,d<=0&&(d=0)):(d++,d>f&&(d=0)),$("#"+this.baseDivId+" #lisr"+e).removeClass("focus"),0===e?this.setLastTypedWord($("#"+b.input).val()):0===d&&(this.setInputBoxText(b,this.getLastTypedWord(),!0),this.setInputBgBoxText(b,this.getFirstLiWord())),0===d?"up"==a?1===e?($(c).attr("focus-id",0),this.setFocusedKwIds("","")):($("#lisr"+f).addClass("focus"),this.setInputBoxText(b,$("#"+this.baseDivId+" #lisr"+f).attr("keyword-word"),!0),this.setFocusedKwIds($("#"+this.baseDivId+" #lisr"+f).attr("keyword-ids"),$("#"+this.baseDivId+" #lisr"+f).attr("keyword-word")),$(c).attr("focus-id",f),this.bEnableExercisePreview&&(this.timerFetchExercisePreview=setTimeout(this.fetchExercisePreviewWithDelay.bind(this,b,this.getFocusedKwIds(),f),this.timePreviewDelay))):($(c).attr("focus-id",0),this.setFocusedKwIds("","")):($("#"+this.baseDivId+" #lisr"+d).addClass("focus"),this.setInputBoxText(b,$("#"+this.baseDivId+" #lisr"+d).attr("keyword-word"),!0),this.setFocusedKwIds($("#"+this.baseDivId+" #lisr"+d).attr("keyword-ids"),$("#"+this.baseDivId+" #lisr"+d).attr("keyword-word")),$(c).attr("focus-id",d),this.bEnableExercisePreview&&(this.timerFetchExercisePreview=setTimeout(this.fetchExercisePreviewWithDelay.bind(this,b,this.getFocusedKwIds(),d),this.timePreviewDelay)))},this.fetchAutoCompleteDataWithDelay=function(a,b){this.debug("fetchAutoCompleteDataWithDelay()",a,b);for(var c="",d=0;d<3;d++){var e=$("#"+this.baseKwTypeNameInput+d);e.is(":checked")&&(c+=e.val()+",")}c=""!=c?c.substr(0,c.length-1):"1",this.bHaveAutoCompleteResult=!1,this.bFoundAutoCompleteMatch=!1,this.arrLastHintResult=[],this.setLastSearchString(a),this.lastAutoCompletePid.exercice=this.mainAppz.jsearch.fetchAutoCompleteData(a,b,c)},this.fetchAutoCompleteData=function(a,b,c){if(this.debug("fetchAutoCompleteData()",a,b,c),clearTimeout(this.timerFetchAutoComplete),clearTimeout(this.timerFetchExercisePreview),this.lastExercisePreviewPid=0,this.arrRefusedEvent.indexOf(a.which)===-1){if("27"==a.which)return void this.hideAutoComplete();if(" "===b.charAt(0)&&(this.setInputBoxText(c,this.trimStringBeginning(b),!1),this.setCarretRange(c,0,0)),b=b.trim(),"32"==a.which&&""==b)return void this.setInputBoxText(c,"",!0);if("13"!=a.which){if(b==this.getLastSearchString()&&"38"!=a.which&&"40"!=a.which)return;this.setInputBgBoxText(c,""),"38"==a.which?this.changeLiFocus("up",c):"40"==a.which?this.changeLiFocus("down",c):""!=b&&b.length>=this.minStrLen?(b=this.mainAppz.jutils.toLower(b),this.timerFetchAutoComplete=setTimeout(this.fetchAutoCompleteDataWithDelay.bind(this,b,c),this.timeDelay)):(this.resetSingleAutoComplete(c),this.setLastSearchString(""),this.resetPid())}else if(""!=b&&b.length>=this.minStrLen){var d=!0;""==this.getFocusedKwIds()?d=!1:this.setInputBoxText(c,this.getCurrentWord(c),!0),d?this.mainAppz.jsearch.getExerciceListingByKeywordIds(this.getFocusedKwIds(),this.getCurrentWord(c))&&(this.mainAppz.resetSearchWindowResult(this.getCurrentWord(c),!0),this.resetSingleAutoComplete(c),this.setLastSearchString(this.getCurrentWord(c))):this.bHaveAutoCompleteResult&&this.bFoundAutoCompleteMatch?(this.debug("RECHERCHE TEXTE: "+this.getLastSearchString()),this.mainAppz.jsearch.getExerciceListingByWords(this.getLastSearchString())&&(this.mainAppz.resetSearchWindowResult(this.getLastSearchString(),!1),this.resetSingleAutoComplete(c))):this.sendingWordToOurTeamForValidation(c),this.resetPid()}}},this.fetchAutoCompleteDataRFS=function(a,b,c,d,e,f){if(this.debug("fetchAutoCompleteDataRFS()",a,b,c,d,e,f),this.lastAutoCompletePid.exercice==f){var g=!0;if("object"==typeof a&&"undefined"!=typeof a.error&&(g=!1),g&&b.refinput.is(":focus")){var h=Object.keys(a).length,i=0;if(1==h){for(var j in a){a=a[j];break}i=Object.keys(a).length}else if(h>1)return void this.fetchAutoCompleteDataRFS_extend2(a,b,c,d,e);if(i>0){this.bHaveAutoCompleteResult=!0;var k=!1;"string"==typeof a[0].name&&0===a[0].name.indexOf(c)?(this.setFirstLiWord(a[0].name),this.setInputBgBoxText(b,this.getFirstLiWord()),this.setFocusedKwIds("","")):k=!0;var l=e.split(" ");"object"!=typeof l&&(l=[]);var m=1,n='<UL class="listing" focus-id="0" focus-id-max="'+i+'">',o=!1;for(var j in a)if("string"==typeof a[j].name&&("string"==typeof a[j].id||"number"==typeof a[j].id)){this.arrLastHintResult.push(a[j].name);var p=a[j].name,q="";for(var r in l)q+="^"+l[r]+"|[ ]{1}"+l[r]+"|";""!=q&&(q=q.substr(0,q.length-1),p=p.replace(new RegExp(q,"gi"),function(a){return o=!0,'<span class="hint">'+a+"</span>"})),n+='<LI keyword-ids="'+a[j].id+'" keyword-word="'+a[j].name+'" keyword-type ="'+d+'" class="single-result" preview-loaded="0" li-pos="'+m+'" id="lisr'+m+'"><DIV class="mclick" keyword-ids="'+a[j].id+'" keyword-word="'+a[j].name+'" keyword-type ="'+d+'" li-pos="'+m+'">'+p+"</DIV></LI>",m++}return n+="</UL>",k&&(this.setInputBgBoxText(b,""),this.setFirstLiWord(""),this.setFocusedKwIds("","")),o&&(this.bFoundAutoCompleteMatch=!0),$("#"+this.baseDivId).html(n),$("#"+this.baseDivId).css({display:"block"}),$("#"+this.baseDivId+" .single-result > .mclick").data("params",b),$("#"+this.baseDivId+" .single-result > .mclick").data("uid",this.uid),this.bEnableMouseOver&&($("#"+this.baseDivId+" .single-result > .mclick").mouseover(function(a){var b=$(document).data("jappzclass-"+$(this).data("uid"));"object"==typeof b&&(clearTimeout(b.jautocomplete.timerFetchExercisePreview),b.jautocomplete.lastExercisePreviewPid=0,b.jautocomplete.setFocusedKwIds($(this).attr("keyword-ids"),$(this).attr("keyword-word")),b.jautocomplete.bEnableExercisePreview&&(b.jautocomplete.timerFetchExercisePreview=setTimeout(b.jautocomplete.fetchExercisePreviewWithDelay.bind(b.jautocomplete,$(this).data("params"),b.jautocomplete.getFocusedKwIds(),$(this).attr("li-pos")),b.jautocomplete.timePreviewDelay)))}),$("#"+this.baseDivId+" .single-result > .mclick").mouseout(function(a){var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){clearTimeout(b.jautocomplete.timerFetchExercisePreview),b.jautocomplete.lastExercisePreviewPid=0;var c=$(this).attr("li-pos");$("#"+b.baseDivId+" #lisr"+c+" > UL.exercises").css({display:"none"}),"1"==$("#"+b.baseDivId+" #lisr"+c).attr("preview-loaded")&&$("#"+b.baseDivId+" #lisr"+c).attr("preview-loaded","2")}})),void $("#"+this.baseDivId+" .single-result > .mclick").click(function(a){a.preventDefault();var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){var c=$(this).attr("keyword-ids"),d=$(this).attr("keyword-word"),e=$(this).data("params");b.debug(e.input+" -> Clicked"),b.jautocomplete.setInputBoxText(e,d,!0),e.refinput.focus(),b.jautocomplete.setFocusedKwIds(c,d),b.jsearch.getExerciceListingByKeywordIds(b.jautocomplete.getFocusedKwIds(),b.jautocomplete.getCurrentWord(e))&&(b.resetSearchWindowResult(b.jautocomplete.getCurrentWord(e),!0),b.jautocomplete.setLastSearchString(b.jautocomplete.getCurrentWord(e))),b.jautocomplete.resetSingleAutoComplete(e)}})}this.setFirstLiWord(""),this.setFocusedKwIds("",""),this.setInputBgBoxText(b,"");var n='<UL class="listing" focus-id="0" focus-id-max="0"><LI class="single-result-title">'+this.jlang.t("no result")+"</LI></UL>";return $("#"+this.baseDivId).html(n),void $("#"+this.baseDivId).css({display:"block"})}this.resetSingleAutoComplete(b)}},this.fetchAutoCompleteDataRFS_extend2=function(a,b,c,d,e){this.debug("fetchAutoCompleteDataRFS_extend2()",a,b,c,d,e);var f=!0,g=e.split(" ");"object"!=typeof g&&(g=[]);var h=1,i=0,j="",f=!1;for(var k in a){var l=Object.keys(a[k]).length;if(l>0){i+=l,this.bHaveAutoCompleteResult=!0,"string"==typeof a[k][0].name&&"1"==k&&0===a[k][0].name.indexOf(c)?(this.setFirstLiWord(a[k][0].name),this.setInputBgBoxText(b,this.getFirstLiWord()),this.setFocusedKwIds("","")):f=!0,j+='<LI class="single-result-title">'+this.jlang.t(this.arrKwType[k])+"</LI>";var m=!1;for(var n in a[k])if("string"==typeof a[k][n].name&&("string"==typeof a[k][n].id||"number"==typeof a[k][n].id)){this.arrLastHintResult.push(a[k][n].name);var o=a[k][n].name,p="";for(var q in g)p+="^"+g[q]+"|[ ]{1}"+g[q]+"|";""!=p&&(p=p.substr(0,p.length-1),o=o.replace(new RegExp(p,"gi"),function(a){return m=!0,'<span class="hint">'+a+"</span>"})),j+='<LI keyword-ids="'+a[k][n].id+'" keyword-word="'+a[k][n].name+'" keyword-type ="'+k+'" class="single-result" preview-loaded="0" li-pos="'+h+'" id="lisr'+h+'"><DIV class="mclick" keyword-ids="'+a[k][n].id+'" keyword-word="'+a[k][n].name+'" keyword-type ="'+k+'" li-pos="'+h+'">'+o+"</DIV></LI>",h++}}}if(f&&(this.setInputBgBoxText(b,""),this.setFirstLiWord(""),this.setFocusedKwIds("","")),m&&(this.bFoundAutoCompleteMatch=!0),this.bHaveAutoCompleteResult){var r='<UL class="listing" focus-id="0" focus-id-max="'+i+'">'+j+"</UL>";return $("#"+this.baseDivId).html(r),$("#"+this.baseDivId).css({display:"block"}),$("#"+this.baseDivId+" .single-result > .mclick").data("params",b),$("#"+this.baseDivId+" .single-result > .mclick").data("uid",this.uid),this.bEnableMouseOver&&($("#"+this.baseDivId+" .single-result > .mclick").mouseover(function(a){var b=$(document).data("jappzclass-"+$(this).data("uid"));"object"==typeof b&&(clearTimeout(b.jautocomplete.timerFetchExercisePreview),b.jautocomplete.lastExercisePreviewPid=0,b.jautocomplete.setFocusedKwIds($(this).attr("keyword-ids"),$(this).attr("keyword-word")),b.jautocomplete.bEnableExercisePreview&&(b.jautocomplete.timerFetchExercisePreview=setTimeout(b.jautocomplete.fetchExercisePreviewWithDelay.bind(b.jautocomplete,$(this).data("params"),b.jautocomplete.getFocusedKwIds(),$(this).attr("li-pos")),b.jautocomplete.timePreviewDelay)))}),$("#"+this.baseDivId+" .single-result > .mclick").mouseout(function(a){var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){clearTimeout(b.jautocomplete.timerFetchExercisePreview),b.jautocomplete.lastExercisePreviewPid=0;var c=$(this).attr("li-pos");$("#"+b.baseDivId+" #lisr"+c+" > UL.exercises").css({display:"none"}),"1"==$("#"+b.baseDivId+" #lisr"+c).attr("preview-loaded")&&$("#"+b.baseDivId+" #lisr"+c).attr("preview-loaded","2")}})),void $("#"+this.baseDivId+" .single-result > .mclick").click(function(a){a.preventDefault();var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){var c=$(this).attr("keyword-ids"),d=$(this).attr("keyword-word"),e=$(this).data("params");b.debug(e.input+" -> Clicked"),b.jautocomplete.setInputBoxText(e,d,!0),e.refinput.focus(),b.jautocomplete.setFocusedKwIds(c,d),b.jsearch.getExerciceListingByKeywordIds(b.jautocomplete.getFocusedKwIds(),b.jautocomplete.getCurrentWord(e))&&(b.resetSearchWindowResult(b.jautocomplete.getCurrentWord(e),!0),b.jautocomplete.setLastSearchString(b.jautocomplete.getCurrentWord(e))),b.jautocomplete.resetSingleAutoComplete(e)}})}this.setFirstLiWord(""),this.setFocusedKwIds("",""),this.setInputBgBoxText(b,"");var s='<UL class="listing" focus-id="0" focus-id-max="0"><LI class="single-result-title">'+this.jlang.t("no result")+"</LI></UL>";return $("#"+this.baseDivId).html(s),void $("#"+this.baseDivId).css({display:"block"})},this.triggerInputEvent=function(a){this.debug("triggerInputEvent()",a);var b=$.Event("keyup");b.which=13,$("#"+a).trigger(b)},this.fetchExercisePreviewWithDelay=function(a,b,c){if(this.debug("fetchExercisePreviewWithDelay()",a,b,c),this.bEnableExercisePreview){var d=$("#"+this.baseDivId+" #lisr"+c).attr("preview-loaded");"0"==d?this.lastExercisePreviewPid=this.mainAppz.jsearch.getExerciceListingByKeywordIdsForPreview(a,b,c):"2"==d&&($("#"+this.baseDivId+" #lisr"+c+" > UL.exercises").css({display:"block"}),$("#"+this.baseDivId+" #lisr"+c).attr("preview-loaded","1"))}},this.fetchExercisePreviewRFS=function(a,b,c,d){if(this.debug("fetchExercisePreviewRFS()",a,b,c,d),this.lastExercisePreviewPid!=d)return void this.debug("REJECT("+this.lastExercisePreviewPid+") != "+d);var e=$("#"+this.baseDivId+" #lisr"+c).attr("preview-loaded"),f=a.data,g=a.filters;if("0"==e){var h='<UL class="exercises">';for(var i in f){h+='<LI class="single-exercises">',h+='<DIV class="img-container">',"string"==typeof f[i].thumb&&""!=f[i].thumb&&(h+='<img src="'+gExerciceImagePath+f[i].thumb+'">'),h+="</DIV>",h+='<DIV class="text-container">',h+=""==f[i].shortTitle?f[i].codeExercise:f[i].shortTitle;var j="";if("object"==typeof f[i].filter)for(var k in f[i].filter)j+=g[f[i].filter[k]]+", ";h+="<SPAN>",""!=f[i].title&&(h+="<BR />"+f[i].title),""!=j&&(h+="<BR /><i>("+j.substr(0,j.length-2)+")</i>"),h+="</SPAN>",h+="</DIV>",h+="</LI>"}h+='<LI class="single-exercises maxcount">',h+='<DIV class="text-container">',h+=this.jlang.t("total")+a.maxcount,h+="</DIV>",h+="</LI>",h+="</UL>",$("#"+this.baseDivId+" #lisr"+c).append(h),$("#"+this.baseDivId+" #lisr"+c).attr("preview-loaded",1)}},this.addInputBox=function(){var a={layer:"main-input-"+this.uid,input:"search-input-"+this.uid};this.debug("addInputBox()"),this.arrInputBox[a.input]=a;var b=a.layer+"-div",c='<div id="'+b+'">';c+='<div class="input"><input name="'+a.input+'-bg" id="'+a.input+'-bg" type="text" disabled autocomplete="off" maxlength="256" spellcheck="false" value="'+this.currentSearchWord+'"></div>',c+='<div class="input"><input name="'+a.input+'" id="'+a.input+'" class="translucide" type="text" autocomplete="off" maxlength="256" spellcheck="false" placeholder="'+this.jlang.t("exercises search")+'" value="'+this.currentSearchWord+'"></div>',c+='<div id="'+this.baseDivId+'" class="kw-content-result"></div>',c+="</div>",$("#"+a.layer).html(c),this.bFocusOnInput&&$("#"+a.input).focus(),this.arrInputBox[a.input].refresult=$("#"+b),this.arrInputBox[a.input].refinput=$("#"+a.input),this.arrInputBox[a.input].refinputbg=$("#"+a.input+"-bg"),this.arrInputBox[a.input].refinput.data("params",this.arrInputBox[a.input]),this.arrInputBox[a.input].refinput.data("uid",this.uid),this.arrInputBox[a.input].refinput.keyup(function(a){var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){var c=$(this).data("params");b.jautocomplete.fetchAutoCompleteData(a,$(this).val(),c)}})},this.rmInputBox=function(a){this.debug("rmInputBox()",a),this.arrInputBox[a].refinput.unbind(),this.arrInputBox[a].refinputbg.unbind(),delete this.arrInputBox[a]},this.resetMainAutoComplete=function(){this.debug("resetMainAutoComplete()");for(var a in this.arrInputBox)$("#"+this.baseDivId).css({display:"none"}),$("#"+this.baseDivId).text("")},this.resetSingleAutoComplete=function(a){this.debug("resetSingleAutoComplete()",a),$("#"+this.baseDivId).css({display:"none"}),$("#"+this.baseDivId).text(""),this.setFocusedKwIds("","")},this.hideAutoComplete=function(){this.debug("hideAutoComplete()"),$("#"+this.baseDivId).css({display:"none"})},this.resetSearchInputBox=function(){this.debug("resetSearchInputBox()");for(var a in this.arrInputBox)this.setInputBgBoxText(this.arrInputBox[a],""),this.setFocusedKwIds("",""),this.setInputBoxText(this.arrInputBox[a],"",!0);this.resetMainAutoComplete()},this.resetSingleSearchInputBox=function(a){this.debug("resetSingleSearchInputBox()",a),this.setInputBgBoxText(a,""),this.setFocusedKwIds("",""),this.setInputBoxText(a,"",!0),this.resetSingleAutoComplete(a)},this.fillInputWithString=function(a,b){this.debug("fillInputWithString()",a,b),this.setInputBoxText(b,a,!0)},this.resetPid=function(){this.debug("resetPid()"),this.lastAutoCompletePid.exercice=0},this.sendingWordToOurTeamForValidation=function(a){this.debug("sendingWordToOurTeamForValidation()",a);var b=this.getLastSearchString(),c=this.jlang.t("no result for {[WORD]}")+"<br />";if(this.bHaveAutoCompleteResult){c+=this.jlang.t("you can try the hints bellow:");for(var d in this.arrLastHintResult)c+='<LI class="single-hint" keyword-word="'+this.arrLastHintResult[d]+'">'+this.arrLastHintResult[d]+"</LI>"}var e='<UL class="listing" focus-id="0" focus-id-max="0"><LI class="single-result-msg">'+c.replace(/\{\[WORD\]\}/g,'<b>"'+b+'"</b>')+"</LI></UL>";$("#"+this.baseDivId).html(e),$("#"+this.baseDivId).css({display:"block"}),this.bHaveAutoCompleteResult&&this.arrLastHintResult.length>0&&($("#"+this.baseDivId+" .single-hint").data("params",a),$("#"+this.baseDivId+" .single-hint").data("uid",this.uid),$("#"+this.baseDivId+" .single-hint").click(function(a){a.preventDefault();var b=$(document).data("jappzclass-"+$(this).data("uid"));if("object"==typeof b){var c=$(this).attr("keyword-word"),d=$(this).data("params");b.jautocomplete.setInputFromHint(c,d)}}))},this.setInputFromHint=function(a,b){this.debug("setInputFromHint()",a,b),this.setInputBoxText(b,a,!0),b.refinput.focus();var c=$.Event("keyup",{which:0});this.hideAutoComplete(),this.fetchAutoCompleteData(c,a,b)},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JComm(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.jlang=this.args.jlang,this.mainAppz=this.args.mainappz,this.pid=100,this},this.getTicket=function(){return this.debug("getTicket()"),this.pid++,this.pid},this.buildExtraParams=function(){var a="";return"string"==typeof gBrand&&""!=gBrand&&(a+="&brand="+gBrand),"string"==typeof gVersioning&&""!=gVersioning&&(a+="&versioning="+gVersioning),a},this.process=function(callerClass,section,service,data,extraObj){this.debug("process()",callerClass,section,service,data,extraObj);var timestamp=Date.now(),pid=this.getTicket();if("undefined"!=typeof this.mainAppz.jserver)return setTimeout(this.mainAppz.jserver.process.bind(this.mainAppz.jserver,{section:section,service:service,data:data,extraobj:extraObj,pid:pid,callerclass:callerClass}),0),pid;var strUrl=gServerPath+"service.php?";return strUrl+=this.buildExtraParams(),gSessionId.length>=26&&(strUrl+="&PHPSESSID="+gSessionId),strUrl+="&time="+timestamp,strUrl+="&lang="+gLocaleLang,$.ajax({parentclass:this,timestamp:timestamp,pid:pid,extraobj:extraObj,callerclass:callerClass,type:"POST",headers:{"cache-control":"no-cache"},cache:!1,async:!0,dataType:"text",url:strUrl,service:service,section:section,data:{section:section,service:service,data:JSON.stringify(data),pid:pid},success:function(dataRtn){"0"!=gDebug?this.parentclass.debug("process().success("+this.pid+")",{dataRtn:dataRtn,time:(Date.now()-this.timestamp)/1e3+"seconds",weight:dataRtn.length/1024/1e3+" Mo"}):this.parentclass.debug("process().success("+this.pid+")",{time:(Date.now()-this.timestamp)/1e3+"seconds",weight:dataRtn.length/1024/1e3+" Mo"});var error="",obj;try{eval("var obj = "+dataRtn+";")}catch(a){error=a}"object"!=typeof obj&&(obj={msgerrors:"<b>"+this.parentclass.jlang.t("server error on service call:")+"</b><br /><br />"+this.section+"."+this.service+"<br /><br /><b>"+this.parentclass.jlang.t("service error:")+"</b><br /><br />"+error}),this.parentclass.debug("process().return("+this.pid+"):",obj,this.extraobj),this.callerclass.commCallBackFunc(this.pid,obj,this.extraobj)},error:function(a,b,c){this.parentclass.debug("process().error("+this.pid+")",this.data,a,b,c),obj={msgerrors:"<b>"+this.parentclass.jlang.t("server error on service call:")+"</b><br /><br />"+this.parentclass.formatErrorMessage(a,c,this.timestamp)},this.callerclass.commCallBackFunc(this.pid,obj,this.extraobj)}}),pid},this.formatErrorMessage=function(a,b,c){this.debug("formatErrorMessage()",a,b,c);var d="";return d=0===a.status?this.jlang.t("Not connected.\nPlease verify your network connection."):404==a.status?this.jlang.t("The requested page not found. [404]"):500==a.status?this.jlang.t("Internal Server Error [500]."):"parsererror"===b?this.jlang.t("Requested JSON parse failed."):"timeout"===b?this.jlang.t("Time out error."):"abort"===b?this.jlang.t("Ajax request aborted."):this.jlang.t("Uncaught Error"+a.responseText),"["+c+"] "+d},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JDebug(){this.className=arguments.callee.name,this.args=arguments[0],this.init=function(){return this.arr=[],this.eol="<br>",this.bAppz=this.args.bAppz,this.bDebug=this.args.bDebug,this},this.show=function(a){this.bDebug&&(this.bAppz?gCallWindow({method:"debug",args:a}):console.log(a))},this.showObject=function(a,b){this.bDebug&&(this.bAppz||(console.log(a+"{"),console.log(b),console.log("}")))},this.add=function(a){this.arr.unshift(a)},this.get=function(a){var a="<pre>";for(var b in this.arr)a=a.replace("<pre>",""),a=a.replace("</pre>",""),a+=this.arr[b]+this.eol;return a+="</pre>"}}function JLang(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.loaded=!1,this.urlDB=this.args.path+"lang."+this.args.lang+".data",this.db=!1,this.getDB(),this},this.setDB=function(a){this.debug("setDB()",a),this.db=a},this.isLoaded=function(){return this.debug("isLoaded()"),this.loaded},this.isReady=function(a){this.debug("isReady()",a),this.loaded=a,$(document).trigger("jlang.Ready",this.loaded)},this.getDB=function(){this.debug("getDB()"),$.ajax({timestamp:Date.now(),parentclass:this,type:"POST",headers:{"cache-control":"no-cache"},cache:!1,async:!0,dataType:"text",url:this.urlDB,success:function(dataRtn){this.parentclass.debug("process().success()",{dataRtn:dataRtn,time:(Date.now()-this.timestamp)/1e3+"seconds",weight:dataRtn.length/1024/1e3+" Mo"});var obj=!1;try{eval("obj = {"+dataRtn+"};")}catch(a){obj=!1}this.parentclass.setDB(obj),this.parentclass.isReady(!0)},error:function(a,b,c){this.parentclass.isReady(!1)}})},this.t=function(a){return this.debug("t()",a),0!=this.db&&"string"==typeof this.db[a]?this.db[a]:"~"+a+"~"},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JSearch(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.jlang=this.args.jlang,this.jcomm=this.args.jcomm,this.mainAppz=this.args.mainappz,this.arrLastResult=[],this.countLastResult=0,this.lastSearchPid=0,this.lastPid=-1,this},this.fetchAutoCompleteData=function(a,b,c){this.debug("fetchAutoCompleteData()",a,b,c);var d={word:a,kwtype:c},e={word:a,params:b,kwtype:c};return this.lastPid=this.jcomm.process(this,"search","fetch-autocomplete",d,e),this.lastPid},this.getExerciceListingByWords=function(a){if(this.debug("getExerciceListingByWords()",a),""==a)return!1;var b={word:a},c={word:a};return this.lastPid=this.jcomm.process(this,"search","get-exercice-listing-by-words",b,c),this.lastSearchPid=this.lastPid,!0},this.getExerciceListingByKeywordIds=function(a,b){if(this.debug("getExerciceListingByKeywordIds()",a,b),""==a)return!1;var c={ids:a,word:b},d={ids:a,word:b};return this.lastPid=this.jcomm.process(this,"search","get-exercice-listing-by-keyword-ids",c,d),this.lastSearchPid=this.lastPid,!0},this.getExerciceListingByKeywordIdsForPreview=function(a,b,c){if(this.debug("getExerciceListingByKeywordIdsForPreview()",a,b,c),""==b)return!1;var d={ids:b},e={ids:b,params:a,strliid:c};return this.lastPid=this.jcomm.process(this,"search","get-exercice-listing-by-keyword-ids-for-preview",d,e),this.lastPid},this.commCallBackFunc=function(a,b,c){this.debug("commCallBackFunc()",a,b,c),"string"==typeof b.msgerrors&&""!=b.msgerrors?this.debug(b.msgerrors):"search"==b.section&&("fetch-autocomplete"==b.service?this.mainAppz.jautocomplete.fetchAutoCompleteDataRFS(b.data.result,c.params,c.word,c.kwtype,b.data.cword,a):"get-exercice-listing-by-keyword-ids"==b.service?a==this.lastSearchPid&&(this.routineOnListingResult(b.data),this.mainAppz.fillSearch(b.data,c.word)):"get-exercice-listing-by-words"==b.service?a==this.lastSearchPid&&(this.routineOnListingResult(b.data),this.mainAppz.fillSearch(b.data,c.word)):"get-exercice-listing-by-keyword-ids-for-preview"==b.service&&this.mainAppz.jautocomplete.fetchExercisePreviewRFS(b.data,c.params,c.strliid,a))},this.routineOnListingResult=function(a){this.debug("routineOnListingResult()"),this.clear(),this.arrLastResult=a,this.countLastResult=this.arrLastResult.length},this.clear=function(){this.debug("clear()"),this.arrLastResult=[],this.countLastResult=0},this.contains=function(a){return this.debug("contains()",a),"object"==typeof this.arrExercices[o]},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JServer(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.jlang=this.args.jlang,this.db=!1,this.lang=this.args.lang,this.path=this.args.path,this.urlDB=this.path+"db-kw."+this.lang+".data",this.maxRows=10,this.serverFormProcess=this.args.serverFormProcess,this.getDB(),this},this.process=function(a){if(this.debug("process()",a),this.db===!1)return a.callerclass.commCallBackFunc(a.pid,{msgerrors:'Local DB "'+this.urlDB+'" not available'},a.extraobj),!1;switch(a.section){case"search":this.processSearch(a);break;default:a.callerclass.commCallBackFunc(a.pid,{msgerrors:"Section not available"},a.extraobj)}},this.processSearch=function(a){switch(this.debug("processSearch()",a),a.service){case"fetch-autocomplete":this.fetchAutocomplete(a);break;case"get-exercice-listing-by-keyword-ids":this.gotoSearchPage(a);break;case"get-exercice-listing-by-words":this.gotoSearchPage(a);break;default:a.callerclass.commCallBackFunc(a.pid,{msgerrors:"Service not available"},a.extraobj)}},this.gotoSearchPage=function(a){if(this.debug("gotoSearchPage()",a),"string"==typeof this.serverFormProcess&&"string"==typeof a.data.word&&""!=a.data.word){var b=this.trimKeyword(a.data.word);if(""!=b){var c=this.serverFormProcess+"?";c+="&lang="+this.lang,c+="&type=search-exercises",c+="&keyword="+encodeURI(b),this.debug("REDIRECTION: "+c),window.top.location.href=c}}return!1},this.fetchAutocomplete=function(a){this.debug("fetchAutocomplete()",a);var b=[],c=[],d=[],e="";if("string"==typeof a.data.word&&""!=a.data.word&&(e=this.trimKeyword(a.data.word),""!=e&&(d=e.split(" ").slice(0,4),d.length))){for(var f in d){if(c=this.db.match(new RegExp(this.regexWordPermutation(d),"gi")),"object"==typeof c&&c)break;d.length>1&&(d=d.slice(0,d.length-1))}if(c||d[0].length>1&&(c=this.db.match(new RegExp(this.regexWordsWithSpace(d[0]),"gi"))),"object"==typeof c&&c){this.debug("arrWord",c),c=c.slice(0,this.maxRows);
for(var f in c)b.push({id:f,name:c[f].substring(1)})}}var g={section:a.section,service:a.service,data:{cword:e,result:{1:b}}};a.callerclass.commCallBackFunc(a.pid,g,a.extraobj)},this.trimKeyword=function(a){return this.debug("trimKeyword()",a),a=a.toLowerCase(),a=a.replace(/[^a-zA-Z0-9\sÞßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýþÿ]/gi," "),a=a.replace(/[\s]+/gi," "),a=a.trim()},this.regexWordPermutation=function(a){this.debug("regexWordPermutation()",a);var b=this.permutateArr(a),c=[""];return b.forEach(function(a,b){var c="",d="";for(var e in a)1==a.length?(c="\\|[a-z0-9\\s]{0,}[\\s]{1}"+a[e]+"[a-z0-9\\s]{0,}",d="\\|"+a[e]+"[a-z0-9\\s]{0,}"):0==e?(c="\\|[a-z0-9\\s]{0,}[\\s]{1}"+a[e]+"[a-z0-9\\s]{0,}[\\s]{1}",d="\\|"+a[e]+"[a-z0-9\\s]{0,}[\\s]{1}"):e==a.length-1?(c+=a[e]+"[a-z0-9\\s]{0,}",d+=a[e]+"[a-z0-9\\s]{0,}"):(c+=a[e]+"[a-z0-9\\s]{0,}[\\s]{1}",d+=a[e]+"[a-z0-9\\s]{0,}[\\s]{1}");this[0]+=d+"|"+c+"|"},c),c=c[0].substring(0,c[0].length-1),this.debug("REGEX[1]: "+c),c},this.regexWordsWithSpace=function(a){this.debug("regexWordsWithSpace()",a);var b="",c="",d="",e="",f="";a=a.substring(0,5);for(var g=0;g<a.length-1;g++){d="";for(var h=0;h<a.length-(a.length-(g+1));h++)d+=a.charAt(h);e="";for(var h=g+1;h<a.length;h++)e+=a.charAt(h);b+="\\|"+d+"[a-z0-9]{1,2}"+e+"[a-z0-9\\s]{0,}|",c+="\\|[a-z0-9\\s]{0,}[\\s]{1}"+d+"[a-z0-9]{1,2}"+e+"[a-z0-9\\s]{0,}|"}return""!=b&&""!=c&&(b=b.substring(0,b.length-1),c=c.substring(0,c.length-1),f=b+"|"+c),this.debug("REGEX[2]: "+f),f},this.permutateArr=function(a){function c(a,d){for(var e,d=d||[],f=0;f<a.length;f++)e=a.splice(f,1),0===a.length&&b.push(d.concat(e)),c(a.slice(),d.concat(e)),a.splice(f,0,e[0]);return b}var b=[];return c(a)},this.setDB=function(a){this.debug("setDB()",a),this.db=a},this.getDB=function(){this.debug("getDB()"),$.ajax({timestamp:Date.now(),parentclass:this,type:"POST",headers:{"cache-control":"no-cache"},cache:!1,async:!0,dataType:"text",url:this.urlDB,success:function(dataRtn){this.parentclass.debug("process().success()",{dataRtn:dataRtn,time:(Date.now()-this.timestamp)/1e3+"seconds",weight:dataRtn.length/1024/1e3+" Mo"});var obj=!1;try{eval('obj = "'+dataRtn+'";')}catch(a){obj=!1}this.parentclass.debug(this.url+" loaded"),this.parentclass.setDB(obj)},error:function(a,b,c){this.parentclass.debug(this.url+" NOT loaded")}})},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}function JUtils(){this.className=arguments.callee.name,this.args=arguments[0],this.jdebug=this.args.jdebug,this.init=function(){return this.debug("init()",this.args),this.jlang=this.args.jlang,this},this.contains=function(a,b){this.debug("contains()",a,b);for(var c=b.length;c--;)if(a===b[c])return!0;return!1},this.countArray=function(a){this.debug("countArray()",a);var b=0;for(var c in a)b++;return b},this.toUpper=function(a){return this.debug("toUpper()",a),a.toUpperCase()},this.toLower=function(a){return this.debug("toLower()",a),a.toLowerCase()},this.isElementVisible=function(a,b){this.debug("isElementVisible()",a,b);var c=$(a),d=$(window),e=d.scrollTop(),f=e+d.height(),g=c.offset().top,h=g+c.height(),i=b===!0?h:g,j=b===!0?g:h;return j<=f&&i>=e},this.pregQuote=function(a,b){return this.debug("pregQuote()",a,b),a=String(a).replace(/\(|\)|\[|\]|\^|\$|\{|\}|\?|\||\.|\=|\+|\-|\*/gi,function(b){return"\\"+b}),a=String(a).replace(/\//gi,"\\/")},this.javascriptFormat=function(a){return this.debug("javascriptFormat()",a),String(a).replace(/"/g,"&quot;")},this.quoteReplace=function(a){return this.debug("quoteReplace()",a),String(a).replace(/"/g,'"')},this.htmlspecialchars_decode=function(a,b){this.debug("htmlspecialchars_decode()",a,b);var c=0,d=0,e=!1;"undefined"==typeof b&&(b=2),a=a.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var f={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===b&&(e=!0),"number"!=typeof b){for(b=[].concat(b),d=0;d<b.length;d++)0===f[b[d]]?e=!0:f[b[d]]&&(c|=f[b[d]]);b=c}return b&f.ENT_HTML_QUOTE_SINGLE&&(a=a.replace(/&#0*39;/g,"'")),e||(a=a.replace(/&quot;/g,'"')),a=a.replace(/&amp;/g,"&")},this.ucfirst=function(a){return this.debug("ucfirst()",a),a.charAt(0).toUpperCase()+a.slice(1)},this.debug=function(){"object"==typeof this.jdebug&&(1==arguments.length?this.jdebug.show(this.className+"::"+arguments[0]):this.jdebug.showObject(this.className+"::"+arguments[0],arguments))}}